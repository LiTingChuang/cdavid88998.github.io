<!DOCTYPE html>
<!-- saved from url=(0055)https://www.fubon.com/securities/hot_new/event-all.html -->
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¯Œé‚¦è­‰åˆ¸ 168è³‡è¨Šç™¼å¸ƒç«™</title>
  <style>
    .hidden {
        display: none;
    }
</style>
  <!-- Bootstrap -->
  <link href="./å¯Œé‚¦è­‰åˆ¸ å¥½åº·æ´»å‹•ä»»æ„é–€_files/bootstrap-4.0.0.css" rel="stylesheet" />
  <link rel="shortcut icon" href="https://www.fubon.com/securities/hot_new/images/logo_s.png" />
  <script src="./å¯Œé‚¦è­‰åˆ¸ å¥½åº·æ´»å‹•ä»»æ„é–€_files/jquery.min.js.ä¸‹è¼‰"></script>
</head>

<body>
  <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-fbblue">
    <div class="container">
      <a href="https://www.fbs.com.tw/"><img src="./å¯Œé‚¦è­‰åˆ¸ å¥½åº·æ´»å‹•ä»»æ„é–€_files/logo.png" width="150" height="38" border="0" /></a>
    </div>
  </nav> -->
<!-- 
  <div style="height: 30px">&nbsp;</div>
  <h2 id="gift" class="text-center">â™¥ï¸æ•¸ä½è¦äººå¹«ï¼Œæ•¸é‡‘æˆ‘ä¾†å¹«â™¥ï¸</h2>
  <div style="height: 15px">&nbsp;</div> -->
  <div class="container">
    <h5 id="title">åˆ†äº«çµæŸå¾Œï¼Œå³å¯é—œé–‰æ­¤ç¶²é ã€‚</h5>
    <!-- <div class="row text-center mt-4"></div> -->
    <!-- <div class="row text-center mt-4" id="result"></div> -->

    <!---->
  </div>

  <!-- <div style="height: 20px">&nbsp;</div>
  <div class="navbar text-white bg-gray p-4">
    <div class="container">
      <div class="row">
        <div class="col-md-4 fot col-lg-12 ta-center">
          <address>
            <strong>å¯Œé‚¦ç¶œåˆè­‰åˆ¸è‚¡ä»½æœ‰é™å…¬å¸</strong>
            110å¹´é‡‘ç®¡è­‰ç¸½å­—ç¬¬0015è™Ÿ<br />
            ç¸½å…¬å¸åœ°å€ï¼šå°åŒ—å¸‚å¤§å®‰å€ä»æ„›è·¯å››æ®µ169è™Ÿ3,4æ¨“<br />å®¢æœå°ˆç·šï¼š02-8178-3018ã€
            0800-073-588<br />å®¢æœä¿¡ç®±ï¼šservice.sec@fubon.com
          </address>
        </div>
      </div>
    </div>
  </div>
  <div id="moddd"></div> -->
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="./å¯Œé‚¦è­‰åˆ¸ å¥½åº·æ´»å‹•ä»»æ„é–€_files/jquery-3.2.1.min.js.ä¸‹è¼‰"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="./å¯Œé‚¦è­‰åˆ¸ å¥½åº·æ´»å‹•ä»»æ„é–€_files/popper.min.js.ä¸‹è¼‰"></script>
  <script src="./å¯Œé‚¦è­‰åˆ¸ å¥½åº·æ´»å‹•ä»»æ„é–€_files/bootstrap-4.0.0.js.ä¸‹è¼‰"></script>

  <!-- <script>
  var one;
  $(function () {
      $.getJSON("./å¯Œé‚¦è­‰åˆ¸ å¥½åº·æ´»å‹•ä»»æ„é–€_files/test.json", function (data) {
          one = data;
      });
    });
  </script> -->
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    //é‡å†™alert
    window.alert = function (name) {
        var iframe = document.createElement("IFRAME");
        iframe.style.display = "none";
        iframe.setAttribute("src", 'data:text/plain,');
        document.documentElement.appendChild(iframe);
        window.frames[0].window.alert(name);
        iframe.parentNode.removeChild(iframe);
    }
    //é‡å†™confirm ä¸æ˜¾ç¤ºipåœ°å€  
    var wConfirm = window.confirm;
    window.confirm = function (message) {
        try {
            var iframe = document.createElement("IFRAME");
            iframe.style.display = "none";
            iframe.setAttribute("src", 'data:text/plain,');
            document.documentElement.appendChild(iframe);
            var alertFrame = window.frames[0];
            var iwindow = alertFrame.window;
            if (iwindow == undefined) {
                iwindow = alertFrame.contentWindow;
            }
            var result = iwindow.confirm(message);
            iframe.parentNode.removeChild(iframe);
            return result;
        } catch (exc) {
            return wConfirm(message);
        }
    }
  </script>
  <script>
    window.onload = function () {
        const useNodeJS = false; // if you are not using a node server, set this value to false
        const defaultLiffId = "1656693260-1NYWwV9E"; // change the default LIFF value if you are not using a node server

        // DO NOT CHANGE THIS
        let myLiffId = "";

        // if node is used, fetch the environment variable and pass it to the LIFF method
        // otherwise, pass defaultLiffId
        if (useNodeJS) {
            fetch('/send-id')
                .then(function (reqResponse) {
                    return reqResponse.json();
                })
                .then(function (jsonResponse) {
                    myLiffId = jsonResponse.id;
                    initializeLiffOrDie(myLiffId);
                })
                .catch(function (error) {
                    document.getElementById("liffAppContent").classList.add('hidden');
                    document.getElementById("nodeLiffIdErrorMessage").classList.remove('hidden');
                });
        } else {
            myLiffId = defaultLiffId;
            initializeLiffOrDie(myLiffId);
        }
    };

    /**
     * Check if myLiffId is null. If null do not initiate liff.
     * @param {string} myLiffId The LIFF ID of the selected element
     */
    function initializeLiffOrDie(myLiffId) {
        if (!myLiffId) {
            document.getElementById("liffAppContent").classList.add('hidden');
            document.getElementById("liffIdErrorMessage").classList.remove('hidden');
        } else {
            initializeLiff(myLiffId);
        }
    }

    /**
     * Initialize LIFF
     * @param {string} myLiffId The LIFF ID of the selected element
     */
     function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //æ„é€ ä¸€ä¸ªå«æœ‰ç›®æ ‡å‚æ•°çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡
        var r = window.location.search.substr(1).match(reg); //åŒ¹é…ç›®æ ‡å‚æ•°
        if (r != null) return unescape(r[2]);
        return null; //è¿”å›å‚æ•°å€¼
    }
    var formdict = {}
    $.getJSON('https://fbsline.github.io/data.json',function(data){ 
        $.each(data, function(key,value){ 
          let button_list = ""
          $.each(value.button, function(key,value){  
              console.log(value.label);
              let one = ""
              one = '{"type":"button","action":{"type":"uri","label":"'+ value.label +'","uri":"'+ value.uri +'"},"style":"primary","color":"#f47721","height":"sm"}'
              button_list = button_list + "," + one
              console.log(button_list)
          }) 
          let button_list1 = button_list.slice(1);
          if (value.type == "edm"){
            if(!value.flex){
              value.flex = 1
            }
            formdict[value.formid] = '{"type":"bubble","body":{"type":"box","layout":"vertical","contents":[{"type":"image","url":"'+ value.imgsrc +'","size":"full","aspectRatio":"'+ value.ratio +'","aspectMode":"cover","gravity":"top","action": {"type": "uri","label": "action","uri": "'+ value.eventurl +'"}}],"paddingAll":"0px"},"footer":{"type":"box","layout":"vertical","spacing":"sm","contents":[{"type":"box","layout":"horizontal","contents":[{"type":"button","style":"primary","height":"sm","action":{"type":"uri","label":"åˆ†äº«","uri":"https://liff.line.me/1656732953-Oe4W0ZQG?formid='+ value.formid + '"},"color":"#f47721"},{"type":"button","style":"primary","height":"sm","action":{"type":"uri","label":"'+ value.linebuttonname +'","uri":"'+ value.eventurl + '"},"color":"#f47721","flex": '+ value.flex +'}],"spacing":"md"},{"type":"box","layout":"vertical","contents":['+ button_list1 +'],"spacing":"sm"}],"flex":0 }}'
          } else{
            if(!value.flex){
              value.flex = 1
            }
            formdict[value.formid] = '{"type":"bubble","hero":{"type":"image","url":"' + value.cardimg + '","size":"full","aspectRatio":"7:4","aspectMode":"cover","action":{"type":"uri","uri":"' + value.eventurl + '"}},"body":{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","text":"'+ value.linetext + '","wrap":true,"action":{"type":"uri","label":"action","uri":"'+ value.secsrc + '"}}]}],"action":{"type":"uri","label":"action","uri":"'+ value.secsrc + '"}},"footer":{"type":"box","layout":"vertical","spacing":"sm","contents":[{"type":"box","layout":"horizontal","contents":[{"type":"button","style":"primary","height":"sm","action":{"type":"uri","label":"åˆ†äº«","uri":"https://liff.line.me/1656732953-Oe4W0ZQG?formid='+ value.formid + '"},"color":"#f47721"},{"type":"button","style":"primary","height":"sm","action":{"type":"uri","label":"'+ value.linebuttonname +'","uri":"'+ value.eventurl + '"},"color":"#f47721","flex": '+ value.flex +'}],"spacing":"md"},{"type":"box","layout":"vertical","contents":['+ button_list1 +'],"spacing":"sm"}],"flex":0 }}';
          }
      })
    })


    function initializeLiff(myLiffId) {
        liff
            .init({
                liffId: myLiffId
            })
            .then(() => {
                // start to use LIFF's api
                console.log("Liff IDæ²’å•é¡Œ");
                let val = getUrlParam('formid');
                let p4 = getUrlParam('P4');
                let clerk = getUrlParam('CLERK');
                let branchid = getUrlParam('BRANCHID');
                let cardtype = getUrlParam('cardtype');
                console.log(formdict[val]);
                console.log(p4);
                console.log(clerk);
                console.log(branchid);
                console.log(cardtype);
                let content = formdict[val];
                if (cardtype == "open") {
                  if (p4 != null && clerk != null && branchid != null){
                    let openurl = "https://mopen.fbs.com.tw/eOpen/indexH5.html?utm_source=sec168&P4=" + p4 + "&SOURCE=FBS&CLERK=" + clerk + "&BRANCHID=" + branchid +"#/main/home_H5"
                    let reg = /https:\/\/mopen.fbs.com.tw\/eOpen\/indexH5.html\?utm_source=sec168&P4=[A-Za-z0-9_]+&SOURCE=FBS&CLERK=[0-9]+&BRANCHID=[0-9]+#\/main\/home_H/g
                    let checkurl = reg.test(openurl);
                    console.log("check = " + checkurl);
                    
                    let k = JSON.parse(content);
                    
                    
                    k['footer']['contents'][1]['contents'][0]['action']['uri'] = openurl

                    console.log(JSON.stringify(k));
                    // let content = JSON.stringify(k);
                    
                    
                  }else{
                    var k = JSON.parse(content);
                  }
                  // if (checkurl == true){
                  //   let k = JSON.parse(content)
                  //   k['footer']['contents'][1]['contents'][0]['action']['uri'] = openurl;
                  //   let content = JSON.stringify(k)
                  //   console.log(JSON.parse(content))

                  // }
                }else{
                  var k = JSON.parse(content);
                }
                
                if (val != null) {
                  if (!formdict[val]){
                    $("#title").html("<br>è¦ªæ„›çš„å®¢æˆ¶ï¼Œæœ¬æ´»å‹•å·²çµæŸã€‚<br><br>è‹¥æ‚¨æœ‰ç›¸é—œå•é¡Œæƒ è«‹æ´½è©¢å®¢æœä¸­å¿ƒ0800-073-588/02-8178-3018æˆ–æ‰€å±¬ç‡Ÿæ¥­å“¡ï¼›<br><br>é€ æˆæ‚¨çš„ä¸ä¾¿æ•¬è«‹è¦‹è«’ï¼Œè¬è¬ï¼");
                    //liff.closeWindow();
                  }else{
                    if (!liff.isInClient()) { //ä¸æ˜¯ç”¨å…§éƒ¨ç€è¦½å™¨é–‹
                      if (liff.isLoggedIn()) { //ç™»å…¥ç‹€æ…‹
                        // let k = JSON.parse(content);
                        liff.shareTargetPicker([{
                          type:'flex',
                          altText:'ğŸ“¢å“ˆå›‰ï¼Œæ‚¨æœ‰ä¸€å‰‡ä¾†è‡ªå¯Œé‚¦è­‰åˆ¸çš„è¨Šæ¯!',
                          contents: k
                        }
                        ])
                        .then(() => {
                          liff.closeWindow();
                        })
                      }else{
                        liff.login({
                          redirectUri: "https://liff.line.me/1656693260-1NYWwV9E?formid=" + val + "&cardtype=" + cardtype + "&CLERK=" + clerk + "&P4=" + p4 + "&BRANCHID=" + branchid
                        });
                      }
                    }else{
                      // let k = JSON.parse(content);
                      liff.shareTargetPicker([{
                        type:'flex',
                        altText:'ğŸ“¢å“ˆå›‰ï¼Œæ‚¨æœ‰ä¸€å‰‡ä¾†è‡ªå¯Œé‚¦è­‰åˆ¸çš„è¨Šæ¯!',
                        contents: k
                      }
                      ])
                      .then(() => {
                        liff.closeWindow();
                      })
                    }
                  }
                }else{
                  $("#title").html("<br>è¦ªæ„›çš„å®¢æˆ¶ï¼Œæœ¬æ´»å‹•å·²çµæŸã€‚<br><br>è‹¥æ‚¨æœ‰ç›¸é—œå•é¡Œæƒ è«‹æ´½è©¢å®¢æœä¸­å¿ƒ0800-073-588/02-8178-3018æˆ–æ‰€å±¬ç‡Ÿæ¥­å“¡ï¼›<br><br>é€ æˆæ‚¨çš„ä¸ä¾¿æ•¬è«‹è¦‹è«’ï¼Œè¬è¬ï¼");
                  //liff.closeWindow();
                }
                })

            .catch((err) => {
                document.getElementById("liffAppContent").classList.add('hidden');
                document.getElementById("liffInitErrorMessage").classList.remove('hidden');
            });
            console.log(JSON.stringify(k));
    }

    /**
     * Initialize the app by calling functions handling individual app components
     */
    //function initializeApp() {
        //registerButtonHandlers();
      //  registerButtonHandlerss();
        // check if the user is logged in/out, and disable inappropriate button
    //}

    /**
     * Display data generated by invoking LIFF methods
    /**
     * Toggle the login/logout buttons based on the isInClient status, and display a message accordingly
     */

    /**
     * Register event handlers for the buttons displayed in the app
     */

    
  </script>

  <div class="betternet-wrapper"></div>
  <div id="liffAppContent">
    <!-- LIFF INIT ERROR -->
    <div id="liffInitErrorMessage" class="hidden">
        <p>Something went wrong with LIFF initialization.</p>
        <p>LIFF initialization can fail if a user clicks "Cancel" on the "Grant permission" screen, or if an error
            occurs in the process of <code>liff.init()</code>.
    </div>
    <!-- NODE.JS LIFF ID ERROR -->
    <div id="nodeLiffIdErrorMessage" class="hidden">
        <p>Unable to receive the LIFF ID as an environment variable.</p>
    </div>
</body>

</html>